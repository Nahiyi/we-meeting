import{d as J,r as p,a as G,n as K,N as Q,s as T,w as l,b as s,e as t,h as m,f as d,g as _,J as W,c,F as I,z as R,A as X,t as k,B as Z,v as ee,C as te,O as ae,l as le,E as N,L as S,k as oe,o as i,P as ne}from"./index-Dg42PXJN.js";import{A as se}from"./AppShell-CnOUhuHU.js";import{a as ie,c as re,s as de,j as ue,d as me}from"./reserve-DzYUkv46.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const fe={class:"schedule-page"},pe={class:"page-header"},ge={class:"reserve-list"},_e={key:0,class:"loading-state"},ve={key:1,class:"empty-state"},ye={key:2,class:"reserve-cards"},we={class:"card-header"},ke={class:"meeting-name"},Me={class:"card-body"},be={class:"info-row"},Ve={class:"info-row"},Ce={key:0,class:"info-row"},he={class:"card-actions"},Te=J({name:"Schedule",__name:"Schedule",setup(Ne){const j=oe(),M=p(!1),b=p([]),g=p(!1),V=p(!1),C=p(),n=G({meetingName:"",startTime:"",duration:60,joinPassword:""}),$={meetingName:[{required:!0,message:"请输入会议主题",trigger:"blur"}],startTime:[{required:!0,message:"请选择开始时间",trigger:"change"}]};async function v(){M.value=!0;try{b.value=await ie()}catch(o){console.error("加载预约会议失败:",o)}finally{M.value=!1}}function x(){n.meetingName="",n.startTime="",n.duration=60,n.joinPassword="",g.value=!0}function P(o){return o.getTime()<Date.now()-24*60*60*1e3}async function B(){if(C.value){await C.value.validate(),V.value=!0;try{await re({meetingName:n.meetingName,startTime:n.startTime,duration:n.duration,joinPassword:n.joinPassword||void 0,joinType:n.joinPassword?1:0}),N.success("预约创建成功"),g.value=!1,v()}catch(o){console.error("创建预约失败:",o)}finally{V.value=!1}}}async function Y(o){try{const e=await de(o.meetingId);await S({videoOpen:!0}),j.push(`/meeting/${e}`)}catch(e){console.error("开始会议失败:",e)}}async function z(o){if(!o.realMeetingId){N.warning("会议尚未开始");return}try{await ue(o.meetingId),await S({videoOpen:!0}),j.push(`/meeting/${o.realMeetingId}`)}catch(e){console.error("加入会议失败:",e)}}async function A(o){try{await ne.confirm("确定要删除这个预约会议吗？","删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),await me(o.meetingId),N.success("删除成功"),v()}catch(e){e!=="cancel"&&console.error("删除预约失败:",e)}}function H(o){const e=new Date(o),u=e.getMonth()+1,r=e.getDate(),y=e.getHours().toString().padStart(2,"0"),f=e.getMinutes().toString().padStart(2,"0");return`${u}月${r}日 ${y}:${f}`}function U(o){return o.realMeetingId?"started":"pending"}function E(o){return o.realMeetingId?"进行中":"待开始"}const h=p(!1);return K(()=>{h.value||(v(),h.value=!0)}),Q(()=>{h.value&&v()}),(o,e)=>{const u=d("el-icon"),r=d("el-button"),y=d("el-input"),f=d("el-form-item"),F=d("el-date-picker"),w=d("el-option"),L=d("el-select"),O=d("el-form"),q=d("el-dialog");return i(),T(se,null,{default:l(()=>[s("div",fe,[s("div",pe,[e[7]||(e[7]=s("h1",{class:"page-title"},"预定会议",-1)),t(r,{class:"create-btn",onClick:x},{default:l(()=>[t(u,null,{default:l(()=>[t(_(W))]),_:1}),e[6]||(e[6]=m(" 新建预约 ",-1))]),_:1})]),s("div",ge,[M.value?(i(),c("div",_e,[(i(),c(I,null,R(3,a=>s("div",{class:"skeleton-card",key:a})),64))])):b.value.length===0?(i(),c("div",ve,[t(u,{size:48},{default:l(()=>[t(_(X))]),_:1}),e[9]||(e[9]=s("p",null,"暂无预约会议",-1)),t(r,{onClick:x},{default:l(()=>[...e[8]||(e[8]=[m("创建第一个预约",-1)])]),_:1})])):(i(),c("div",ye,[(i(!0),c(I,null,R(b.value,a=>(i(),c("div",{key:a.meetingId,class:"reserve-card"},[s("div",we,[s("span",ke,k(a.meetingName),1),s("span",{class:Z(["status-badge",U(a)])},k(E(a)),3)]),s("div",Me,[s("div",be,[t(u,null,{default:l(()=>[t(_(te))]),_:1}),s("span",null,k(H(a.startTime)),1)]),s("div",Ve,[t(u,null,{default:l(()=>[t(_(ae))]),_:1}),s("span",null,"时长 "+k(a.duration)+" 分钟",1)]),a.joinPassword?(i(),c("div",Ce,[t(u,null,{default:l(()=>[t(_(le))]),_:1}),e[10]||(e[10]=s("span",null,"需要密码",-1))])):ee("",!0)]),s("div",he,[a.realMeetingId?(i(),T(r,{key:0,type:"primary",size:"small",onClick:D=>z(a)},{default:l(()=>[...e[11]||(e[11]=[m(" 加入会议 ",-1)])]),_:1},8,["onClick"])):(i(),T(r,{key:1,type:"primary",size:"small",onClick:D=>Y(a)},{default:l(()=>[...e[12]||(e[12]=[m(" 开始会议 ",-1)])]),_:1},8,["onClick"])),t(r,{size:"small",onClick:D=>A(a)},{default:l(()=>[...e[13]||(e[13]=[m(" 删除 ",-1)])]),_:1},8,["onClick"])])]))),128))]))]),t(q,{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=a=>g.value=a),title:"新建预约会议",width:"480px","close-on-click-modal":!1},{footer:l(()=>[t(r,{onClick:e[4]||(e[4]=a=>g.value=!1)},{default:l(()=>[...e[14]||(e[14]=[m("取消",-1)])]),_:1}),t(r,{type:"primary",loading:V.value,onClick:B},{default:l(()=>[...e[15]||(e[15]=[m(" 创建 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(O,{ref_key:"formRef",ref:C,model:n,rules:$,"label-width":"100px"},{default:l(()=>[t(f,{label:"会议主题",prop:"meetingName"},{default:l(()=>[t(y,{modelValue:n.meetingName,"onUpdate:modelValue":e[0]||(e[0]=a=>n.meetingName=a),placeholder:"请输入会议主题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(f,{label:"开始时间",prop:"startTime"},{default:l(()=>[t(F,{modelValue:n.startTime,"onUpdate:modelValue":e[1]||(e[1]=a=>n.startTime=a),type:"datetime",placeholder:"选择开始时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss","disabled-date":P,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(f,{label:"会议时长",prop:"duration"},{default:l(()=>[t(L,{modelValue:n.duration,"onUpdate:modelValue":e[2]||(e[2]=a=>n.duration=a),style:{width:"100%"}},{default:l(()=>[t(w,{label:"30 分钟",value:30}),t(w,{label:"60 分钟",value:60}),t(w,{label:"90 分钟",value:90}),t(w,{label:"120 分钟",value:120})]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"会议密码"},{default:l(()=>[t(y,{modelValue:n.joinPassword,"onUpdate:modelValue":e[3]||(e[3]=a=>n.joinPassword=a),placeholder:"可选，最多5位",maxlength:"5","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])]),_:1})}}}),Re=ce(Te,[["__scopeId","data-v-9b400aef"]]);export{Re as default};
