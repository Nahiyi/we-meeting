import{d as V,r as _,y as w,Y as x,c as o,b as g,v as m,e as r,h as y,f as v,w as T,g as K,a1 as P,F as D,z as B,B as $,t as h,s as O,_ as z,ag as G,o as n,Q as i}from"./index-Dg42PXJN.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"chat-panel"},W={key:0,class:"loading-tip"},q={key:2,class:"no-more-tip"},Q={key:0,class:"msg-sender"},Y={key:0,class:"private-tag"},j={class:"msg-bubble"},X={class:"msg-time"},Z={key:3,class:"empty-tip"},S={key:0,class:"private-select"},ee={class:"chat-input"},te=V({__name:"ChatPanel",props:{messages:{},currentUserId:{},loading:{type:Boolean,default:!1},hasMore:{type:Boolean,default:!1},showPrivateSelect:{type:Boolean,default:!1},members:{default:()=>[]}},emits:["send","loadMore"],setup(e,{expose:d,emit:L}){const c=e,E=L,u=_(""),l=_(null),I=_(""),b=w(()=>c.members.filter(a=>a.userId!==c.currentUserId));function R(a){const t=new Date(a),N=new Date,f=t.toDateString()===N.toDateString(),p=`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`;return f?p:`${t.getMonth()+1}/${t.getDate()} ${p}`}function k(){const a=u.value.trim();a&&(E("send",a,I.value||void 0),u.value="")}function C(){G(()=>{l.value&&(l.value.scrollTop=l.value.scrollHeight)})}function M(){!l.value||c.loading||!c.hasMore||l.value.scrollTop<50&&E("loadMore")}return x(()=>c.messages.length,(a,t)=>{a>t&&C()}),d({scrollToBottom:C}),(a,t)=>{const N=v("el-icon"),f=v("el-option"),p=v("el-select"),U=v("el-input"),A=v("el-button");return n(),o("div",J,[g("div",{class:"chat-messages",ref_key:"messagesRef",ref:l,onScroll:M},[e.loading?(n(),o("div",W,[r(N,{class:"is-loading"},{default:T(()=>[r(K(P))]),_:1}),t[3]||(t[3]=y(" 加载中... ",-1))])):e.hasMore?(n(),o("div",{key:1,class:"load-more-tip",onClick:t[0]||(t[0]=s=>a.$emit("loadMore"))}," 点击加载更多 ")):e.messages.length>0?(n(),o("div",q," 没有更多消息了 ")):m("",!0),(n(!0),o(D,null,B(e.messages,(s,F)=>(n(),o("div",{key:s.messageId||F,class:$(["chat-message",{"is-self":s.sendUserId===e.currentUserId,"is-private":s.receiveType===1}])},[s.sendUserId!==e.currentUserId?(n(),o("div",Q,[y(h(s.sendUserNickName)+" ",1),s.receiveType===1?(n(),o("span",Y,"私聊")):m("",!0)])):m("",!0),g("div",j,h(s.content||s.messageContent),1),g("div",X,h(R(s.sendTime)),1)],2))),128)),e.messages.length===0&&!e.loading?(n(),o("div",Z," 暂无消息，开始聊天吧~ ")):m("",!0)],544),e.showPrivateSelect&&e.members&&e.members.length>1?(n(),o("div",S,[r(p,{modelValue:I.value,"onUpdate:modelValue":t[1]||(t[1]=s=>I.value=s),placeholder:"发送给所有人",clearable:"",size:"small"},{default:T(()=>[r(f,{label:"所有人",value:""}),(n(!0),o(D,null,B(b.value,s=>(n(),O(f,{key:s.userId,label:s.nickName,value:s.userId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):m("",!0),g("div",ee,[r(U,{modelValue:u.value,"onUpdate:modelValue":t[2]||(t[2]=s=>u.value=s),placeholder:"输入消息...",onKeyup:z(k,["enter"]),maxlength:500},null,8,["modelValue"]),r(A,{type:"primary",onClick:k,disabled:!u.value.trim()},{default:T(()=>[...t[4]||(t[4]=[y(" 发送 ",-1)])]),_:1},8,["disabled"])])])}}}),re=H(te,[["__scopeId","data-v-dd3a2f68"]]);var se=(e=>(e[e.SELF=-1]="SELF",e[e.NOT_FRIEND=0]="NOT_FRIEND",e[e.FRIEND=1]="FRIEND",e[e.PENDING=2]="PENDING",e[e.BLACKLISTED=3]="BLACKLISTED",e[e.BE_FRIEND=4]="BE_FRIEND",e))(se||{}),ne=(e=>(e[e.INIT=0]="INIT",e[e.PASS=1]="PASS",e[e.REJECT=2]="REJECT",e[e.BLACKLIST=3]="BLACKLIST",e))(ne||{});function ie(){return i.get("/userContact/loadContactUser")}function de(){return i.get("/userContact/loadContactApply")}function ce(e){return i.get("/userContact/searchContact",{params:{searchUserId:e}})}function ue(e){return i.post("/userContact/contactApply",null,{params:{receiverUserId:e}})}function me(e,d){return i.post("/userContact/dealWithApply",null,{params:{applyUserId:e,status:d}})}var oe=(e=>(e[e.NORMAL=0]="NORMAL",e[e.DEL=1]="DEL",e[e.BLACK=2]="BLACK",e))(oe||{});function ve(e,d){return i.delete("/userContact/operateContact",{params:{contactId:e,status:d}})}export{ne as A,se as C,de as a,re as b,ue as c,me as d,oe as e,ie as l,ve as o,ce as s};
